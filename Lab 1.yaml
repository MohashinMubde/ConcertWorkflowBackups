name: Lab 1
platform: node
blocks:
  - action: system/Excel/Create File
    name: deviceMetaData
  - action: assign
    name: Assign_1
    variable: $filedata
    value: $deviceMetaData.result
  - action: system/SevOne/REST v3/Metadata/Metadata Devices
    name: SevOneMetaData
    inputs:
      - name: authKey
        value: '"admin/NMS-SevOne"'
  - action: foreach
    name: ForEach_1
    list: $SevOneMetaData.result.devices
    blocks:
      - action: if
        name: If_1
        condition: $ForEach_1.isFirst
        then:
          - action: system/Common/Object/Object Keys
            name: ObjectKeys_1
            inputs:
              - name: object
                value: $ForEach_1.item
          - action: system/Excel/Append Row
            name: addHeader
            inputs:
              - name: values
                value: $ObjectKeys_1.result
              - name: sheetName
                value: '"Sheet1"'
              - name: fileData
                value: $filedata
          - action: system/Common/Object/Object Values
            name: ObjectValues_2
            inputs:
              - name: object
                value: $ForEach_1.item
          - action: system/Excel/Append Row
            name: addFirstRow
            inputs:
              - name: values
                value: $ObjectValues_2.result
              - name: sheetName
                value: '"Sheet1"'
              - name: fileData
                value: $addHeader.result
          - action: assign
            name: Assign_2
            variable: $filedata
            value: $addFirstRow.result
        else:
          - action: system/Common/Object/Object Values
            name: ObjectValues_1
            inputs:
              - name: object
                value: $ForEach_1.item
          - action: system/Excel/Append Row
            name: addAdditionalRows
            inputs:
              - name: values
                value: $ObjectValues_1.result
              - name: sheetName
                value: '"Sheet1"'
              - name: fileData
                value: $filedata
          - action: assign
            name: Assign_3
            variable: $filedata
            value: $addAdditionalRows.result
  - action: system/Common/SFTP/SFTP Put File
    name: SFTPPutFile_1
    inputs:
      - name: authKey
        value: '"admin/SSH"'
      - name: file
        value: $XLSX_File_Path
      - name: contents
        value: $filedata
  - action: assign
    name: Assign_4
    variable: $result
    value: '"File Successfully Uploaded"'
variables:
  - name: result
    required: false
    isInput: false
    isOutput: true
    level: INTERMEDIATE
    type:
      type: any
    value: '""'
  - name: filedata
    required: false
    isInput: false
    isOutput: false
    level: INTERMEDIATE
    type:
      type: string
    value: '""'
  - name: XLSX_File_Path
    required: false
    isInput: false
    isOutput: false
    level: INTERMEDIATE
    type:
      type: string
    value: '"/root/deviceMetaData.xlsx"'
meta:
  version: 5
  layout: flow
  workerGroup: default
  description: Complete
finally: null
